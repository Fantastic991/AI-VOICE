<!DOCTYPE html>
<html>
<head>
<title>AI Pronunciation Practice</title>
</head>
<body>
<h1>ğŸ™ï¸ Pronunciation Practice</h1>

<label for="sentenceSelect">Choose a sentence:</label>
<select id="sentenceSelect">
<option>My favorite country is South Korea.</option>
<option>I like learning new languages.</option>
<option>Traveling makes me happy.</option>
<option>Today is a beautiful day.</option>
<option>I want to speak English fluently.</option>
</select>

<p id="targetSentence"></p>

<button id="recordButton">ğŸ§ Start Recording</button>
<p id="status"></p>
<p id="result"></p>

<!-- à¹€à¸ªà¸µà¸¢à¸‡à¹à¸ˆà¹‰à¸‡à¹€à¸•à¸·à¸­à¸™ -->
<audio id="startBeep" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>
<audio id="stopBeep" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>

<script>
const recordButton = document.getElementById("recordButton");
const status = document.getElementById("status");
const result = document.getElementById("result");
const startBeep = document.getElementById("startBeep");
const stopBeep = document.getElementById("stopBeep");
const sentenceSelect = document.getElementById("sentenceSelect");
const targetSentence = document.getElementById("targetSentence");

let recorder;
let chunks = [];
let hasSpoken = false;
let speakingThreshold = 3000;

// à¹à¸ªà¸”à¸‡à¸›à¸£à¸°à¹‚à¸¢à¸„à¸—à¸µà¹ˆà¹€à¸¥à¸·à¸­à¸
targetSentence.textContent = "Say this: " + sentenceSelect.value;
sentenceSelect.addEventListener("change", () => {
targetSentence.textContent = "Say this: " + sentenceSelect.value;
});

recordButton.addEventListener("click", async () => {
if (!recorder || recorder.state === "inactive") {
await startBeep.play().catch(() => {});
status.textContent = "ğŸ™ï¸ Recording... please speak now. (à¸à¸¹à¸”à¹ƒà¸à¸¥à¹‰à¹„à¸¡à¸„à¹Œà¸«à¸™à¹ˆà¸­à¸¢à¸™à¸°)";
result.textContent = "";
hasSpoken = false;

const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
recorder = new MediaRecorder(stream);
chunks = [];

recorder.ondataavailable = e => chunks.push(e.data);

recorder.onstop = async () => {
await stopBeep.play().catch(() => {});
status.textContent = "â³ Analyzing your voice...";

if (!hasSpoken) {
result.textContent = "â— Please say something before stopping.";
status.textContent = "";
return;
}

const audioBlob = new Blob(chunks, { type: "audio/webm" });
const fakeScore = Math.floor(Math.random() * 11) + 85;
await new Promise(r => setTimeout(r, 1000));
result.textContent = `Sentence: "${sentenceSelect.value}"
â†’ Score: ${fakeScore}/100 ğŸ¯`;
status.textContent = "";
};

recorder.start();
recordButton.textContent = "ğŸ›‘ Stop Recording";

const audioContext = new AudioContext();
const source = audioContext.createMediaStreamSource(stream);
const analyser = audioContext.createAnalyser();
analyser.fftSize = 512;
source.connect(analyser);
const dataArray = new Uint8Array(analyser.frequencyBinCount);

function checkVoice() {
analyser.getByteFrequencyData(dataArray);
const avg = dataArray.reduce((a, b) => a + b, 0) / dataArray.length;
if (avg > speakingThreshold) hasSpoken = true;
if (recorder && recorder.state === "recording") requestAnimationFrame(checkVoice);
}
checkVoice();

} else {
recorder.stop();
recordButton.textContent = "ğŸ§ Start Recording";
status.textContent = "Processing your voice...";
}
});
</script>
</body>
</html>
