<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>AI Speaking Practice</title>
<style>
body {
font-family: Arial, sans-serif;
text-align: center;
background-color: #f8f9fa;
padding: 40px;
}
h1 {
color: #333;
}
#targetSentence {
font-size: 1.5em;
margin: 20px 0;
}
select, button {
font-size: 1em;
padding: 10px;
margin: 10px;
cursor: pointer;
}
#accentButtons button {
border: none;
border-radius: 8px;
background-color: #e0e0e0;
}
#accentButtons button.active {
background-color: #007bff;
color: white;
}
#result {
margin-top: 20px;
font-size: 1.3em;
font-weight: bold;
color: #007bff;
}
</style>
</head>
<body>
<h1>🎤 AI Speaking Practice</h1>

<label for="sentenceSelect">เลือกประโยค:</label>
<select id="sentenceSelect">
<option>My favorite country is South Korea.</option>
<option>I like to travel every summer.</option>
<option>Learning English is fun and useful.</option>
<option>How are you today?</option>
</select>

<div id="targetSentence">My favorite country is South Korea.</div>

<!-- ปุ่มเลือกสำเนียง -->
<div id="accentButtons">
<button id="usAccent" class="active">🇺🇸 American</button>
<button id="krAccent">🇰🇷 Korean</button>
</div>

<!-- ปุ่มฟังเสียง AI -->
<button id="playButton">🔈 ฟังเสียงตัวอย่าง</button>

<!-- ปุ่มอัดเสียง -->
<div>
<button id="recordButton">🎙️ เริ่มพูด</button>
</div>

<p id="status"></p>
<p id="result"></p>

<!-- เสียงแจ้งเตือนเริ่ม/หยุด -->
<audio id="startBeep" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>
<audio id="stopBeep" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg"></audio>

<script>
const recordButton = document.getElementById("recordButton");
const status = document.getElementById("status");
const result = document.getElementById("result");
const startBeep = document.getElementById("startBeep");
const stopBeep = document.getElementById("stopBeep");
const sentenceSelect = document.getElementById("sentenceSelect");
const targetSentence = document.getElementById("targetSentence");

// ✅ เปลี่ยนประโยคตามที่เลือก
sentenceSelect.addEventListener("change", () => {
targetSentence.textContent = sentenceSelect.value;
result.textContent = "";
});

// 🎧 เสียงแจ้งเตือนเริ่ม/หยุดอัด
let mediaRecorder;
let chunks = [];

recordButton.addEventListener("click", async () => {
if (mediaRecorder && mediaRecorder.state === "recording") {
stopBeep.play();
mediaRecorder.stop();
recordButton.textContent = "🎙️ เริ่มพูด";
status.textContent = "⏹️ หยุดอัดเสียงแล้ว กำลังประมวลผล...";
} else {
startBeep.play();
const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
mediaRecorder = new MediaRecorder(stream);
chunks = [];

mediaRecorder.ondataavailable = (e) => chunks.push(e.data);
mediaRecorder.onstop = () => {
const audioBlob = new Blob(chunks, { type: "audio/wav" });
analyzePronunciation(audioBlob);
};

mediaRecorder.start();
recordButton.textContent = "⏹️ หยุดพูด";
status.textContent = "🎤 กำลังอัดเสียง...";
}
});

// 🧠 ระบบให้คะแนนแบบง่าย (สุ่มเพื่อสาธิต)
function analyzePronunciation(audioBlob) {
status.textContent = "";
const randomScore = Math.floor(Math.random() * 30) + 70;
result.textContent = `⭐ คะแนนการออกเสียง: ${randomScore}/100`;
}

// 🌍 สำเนียง (ค่าเริ่มต้น: en)
let accentLang = "en";

const usAccent = document.getElementById("usAccent");
const krAccent = document.getElementById("krAccent");

usAccent.addEventListener("click", () => {
accentLang = "en";
usAccent.classList.add("active");
krAccent.classList.remove("active");
});

krAccent.addEventListener("click", () => {
accentLang = "ko";
krAccent.classList.add("active");
usAccent.classList.remove("active");
});

// 🔊 ฟังเสียงตัวอย่าง (ตามสำเนียง)
const playButton = document.getElementById("playButton");
playButton.addEventListener("click", () => {
const sentence = targetSentence.textContent.trim();
const url = `https://translate.google.com/translate_tts?ie=UTF-8&client=tw-ob&q=${encodeURIComponent(sentence)}&tl=${accentLang}`;
const audio = new Audio(url);
audio.play();
});
</script>
</body>
</html>
